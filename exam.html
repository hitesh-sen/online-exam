<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Exam</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="light">
    <div class="top-bar">
        <div><b id="student"></b> <button onclick="location.href='index.html'" style="width:auto; padding:5px; background:red;">Exit</button></div>
        <span id="timer">00:00</span>
    </div>

    <div class="login-box" style="max-width: 600px;">
        <h2 id="question">Loading...</h2>
        <div id="options-container"></div>
        <button id="next-btn" onclick="nextQuestion()" style="display:none;">Next Question</button>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwTMB_a1P1s9ukPenPvPxVFF2ZFtyyNN0M0sPe_7FovXpNkzd7yv18LsfZeQ0Y7yN6z4A/exec";
        const name = localStorage.getItem("studentName");
        const cls = localStorage.getItem("studentClass");
        document.getElementById("student").innerText = `${name} | ${cls}`;

        let questions = [], userChoices = [], index = 0;

        fetch(API_URL).then(res => res.json()).then(data => {
            questions = data.sort(() => Math.random() - 0.5).slice(0, 10);
            document.getElementById("next-btn").style.display = "block";
            loadQuestion();
        });

        function loadQuestion() {
            const q = questions[index];
            document.getElementById("question").innerText = `Q${index+1}. ${q.question}`;
            const container = document.getElementById('options-container');
            container.innerHTML = ""; 
            ["a", "b", "c", "d"].forEach(opt => {
                container.innerHTML += `<label class="option-card" style="display:block; margin:10px; padding:10px; border:1px solid #ccc; border-radius:8px;">
                    <input type="radio" name="opt" value="${opt}"> ${q[opt]}
                </label>`;
            });
        }

        function nextQuestion() {
            const sel = document.querySelector("input[name='opt']:checked");
            if (!sel) return alert("Select answer!");
            userChoices.push({
                question: questions[index].question,
                selected: sel.value,
                correct: questions[index].correct,
                options: { a: questions[index].a, b: questions[index].b, c: questions[index].c, d: questions[index].d }
            });
            index++;
            if (index < questions.length) loadQuestion();
            else finish();
        }

        function finish() {
            localStorage.setItem("reviewData", JSON.stringify(userChoices));
            window.location.href = "result.html";
        }

        let sec = 300; // 5 mins
        setInterval(() => {
            let m = Math.floor(sec/60), s = sec%60;
            document.getElementById("timer").innerText = `${m}:${s<10?'0'+s:s}`;
            if (sec-- <= 0) finish();
        }, 1000);
    </script>
</body>
</html>
