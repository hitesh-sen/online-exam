<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Result | Bothverse Academy</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .result-box {
            max-width: 600px;
            margin: 40px auto;
            background: #1e293b;
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .score { font-size: 3rem; color: #22c55e; font-weight: bold; margin: 20px 0; }
        .review-card { background: #0f172a; padding: 15px; border-radius: 10px; margin-top: 15px; text-align: left; border-left: 5px solid #ef4444; }
        .review-card.correct { border-left-color: #22c55e; }
        .btn-home { background: #22c55e; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 20px; transition: 0.3s; }
        .btn-home:hover { background: #16a34a; }

        @media print {
            button, .btn-home, .print-btn { display: none !important; }
            body { background: white !important; color: black !important; }
            .result-box { box-shadow: none !important; margin: 0; width: 100%; color: black !important; background: white !important; }
            .review-card { background: #f8fafc !important; color: black !important; border: 1px solid #ddd !important; border-left: 5px solid #ef4444 !important; }
            .review-card.correct { border-left-color: #22c55e !important; }
        }
    </style>
</head>
<body class="light">
    <div class="result-box">
        <h1>Your Scorecard</h1>
        <p id="student-meta" style="color: #94a3b8;"></p>
        <div class="score" id="display-score">0 / 0</div>
        <div id="status-msg" style="font-size: 1.5rem; margin-bottom: 20px; font-weight: bold;"></div>

        <div id="review-list">
            <h3 style="text-align: left; border-bottom: 1px solid #334155; padding-bottom: 10px;">Review Answers</h3>
            <div id="cards-container"></div>
        </div>

        <button class="print-btn" onclick="window.print()"
            style="background: #3b82f6; color: white; padding: 15px; margin-top: 20px; border-radius: 8px; width: 100%; cursor: pointer; border: none; font-weight: bold;">
            Download / Print Scorecard üìÑ
        </button>

        <button class="btn-home" onclick="location.href='dashboard.html'">Back to Dashboard</button>
    </div>

    <script>
        window.onload = function () {
            const name = localStorage.getItem("studentName") || "Student";
            const cls = localStorage.getItem("studentClass") || "-";
            const rawData = localStorage.getItem("reviewData");

            if (!rawData) {
                document.querySelector(".result-box").innerHTML = "<h2>No Data Found!</h2><button class='btn-home' onclick='location.href=\"dashboard.html\"'>Go Back</button>";
                return;
            }

            const reviewData = JSON.parse(rawData);
            document.getElementById("student-meta").innerText = `${name} | Class: ${cls}`;

            let score = 0;
            const total = reviewData.length;
            const container = document.getElementById("cards-container");

            reviewData.forEach((item, i) => {
                const isCorrect = item.selected === item.correct;
                if (isCorrect) score++;
                
                const card = document.createElement("div");
                card.className = `review-card ${isCorrect ? 'correct' : ''}`;
                card.innerHTML = `
                    <div style="font-weight:bold;">Q${i + 1}. ${item.question}</div>
                    <div style="margin-top:5px; color: ${isCorrect ? '#22c55e' : '#ef4444'}">
                        <b>Your Ans:</b> ${item.options[item.selected] || "Skipped"} ${isCorrect ? '‚úÖ' : '‚ùå'}
                    </div>
                    ${!isCorrect ? `<div style="color: #94a3b8; font-size: 0.9rem; margin-top:3px;"><b>Correct:</b> ${item.options[item.correct]}</div>` : ''}
                `;
                container.appendChild(card);
            });

            localStorage.setItem("lastExamScore", `${score} / ${total}`);
            document.getElementById("display-score").innerText = `${score} / ${total}`;
            
            const percent = (score / total) * 100;
            document.getElementById("status-msg").innerHTML = percent >= 50 ? 
                "<span style='color:#22c55e'>RESULT: PASS üéâ</span>" : 
                "<span style='color:#ef4444'>RESULT: FAIL ‚ùå</span>";

            // Data Sync to Google Sheet
            // Tip: Use URLSearchParams for reliable 'no-cors' delivery
            const scriptURL = "https://script.google.com/macros/s/AKfycbyQaebDFnZ3htPeOajSJVL-rejWjY-Zyfc57hOL4083h-bFZ5IbiQ0UhaUaE6BIDSI43g/exec";
            
            fetch(`${scriptURL}?name=${encodeURIComponent(name)}&cls=${encodeURIComponent(cls)}&score=${score}&total=${total}`, {
                method: "POST",
                mode: "no-cors"
            });
        };
    </script>
</body>
</html>
