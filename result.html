<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Result - Online Exam</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .result-card { text-align: left; margin-top: 20px; }
        .result-line { 
            display: flex; justify-content: space-between; 
            padding: 8px 0; border-bottom: 1px solid #334155; 
        }
        .status-pass { color: #22c55e; font-weight: bold; }
        .status-fail { color: #ef4444; font-weight: bold; }

        /* Review Section Styling */
        #review-section { margin-top: 40px; text-align: left; }
        .review-card {
            background: #1e293b; padding: 15px; border-radius: 8px;
            margin-bottom: 15px; border-left: 5px solid #ef4444;
        }
        .review-card.correct { border-left-color: #22c55e; }
        .question-text { font-weight: bold; margin-bottom: 10px; color: #f8fafc; }
        .ans-row { font-size: 14px; margin: 4px 0; }
        .your-ans { color: #94a3b8; }
        .correct-ans { color: #22c55e; font-weight: bold; }
        
        /* Mobile Responsive Header Fix */
        @media (max-width: 500px) {
            .login-box { width: 90% !important; padding: 20px; }
            h1 { font-size: 24px; }
        }
    </style>
</head>
<body class="light">

<div class="login-box" style="width: 500px; margin-bottom: 50px;">
    <h1>Score Card</h1>
    <h3 id="student-info" style="color: #94a3b8;"></h3>
    <hr style="border: 0; border-top: 1px solid #334155; margin: 20px 0;">

    <div class="result-card">
        <div class="result-line"><span>Score:</span> <span id="score">0</span></div>
        <div class="result-line"><span>Attempted:</span> <span id="attempted">0</span></div>
        <div class="result-line"><span>Percentage:</span> <span id="percentage">0%</span></div>
        <div class="result-line"><span>Status:</span> <span id="status">-</span></div>
        <div class="result-line"><span>Reason:</span> <span id="reason">Normal</span></div>
    </div>

    <div id="review-section">
        <h2>Answer Review</h2>
        <div id="review-container"></div>
    </div>

    <button onclick="location.href='index.html'" style="margin-top: 30px; width: 100%;">Try Again / Home</button>
</div>

<script>
    // 1. Data load karein
    const name = localStorage.getItem("studentName") || "Unknown";
    const cls = localStorage.getItem("studentClass") || "N/A";
    const answers = JSON.parse(localStorage.getItem("answers")) || [];
    const questions = JSON.parse(localStorage.getItem("questions")) || [];
    const reason = localStorage.getItem("reason") || "Normal Submit";

    document.getElementById("student-info").innerText = `${name} | Class: ${cls}`;

    // 2. Score Calculation & Review Logic
    let score = 0;
    let attempted = 0;
    const reviewContainer = document.getElementById("review-container");

    questions.forEach((q, i) => {
        const userAns = answers[i];
        const isCorrect = userAns === q.correct;
        
        if (userAns) {
            attempted++;
            if (isCorrect) score++;
        }

        // Review UI generate karein
        const card = document.createElement("div");
        card.className = `review-card ${isCorrect ? 'correct' : ''}`;
        
        // Option text nikalne ke liye logic (e.g., q['a'])
        const userAnsText = userAns ? q[userAns] : "Not Attempted";
        const correctAnsText = q[q.correct];

        card.innerHTML = `
            <div class="question-text">Q${i+1}. ${q.question}</div>
            <div class="ans-row your-ans">Your Answer: ${userAnsText} ${isCorrect ? '‚úÖ' : '‚ùå'}</div>
            ${!isCorrect ? `<div class="ans-row correct-ans">Correct Answer: ${correctAnsText}</div>` : ''}
        `;
        reviewContainer.appendChild(card);
    });

    const total = questions.length;
    const percent = total > 0 ? Math.round((score / total) * 100) : 0;
    const finalStatus = percent >= 50 ? "PASS üéâ" : "FAIL ‚ùå";

    // 3. UI Update
    document.getElementById("score").innerText = `${score} / ${total}`;
    document.getElementById("attempted").innerText = `${attempted} / ${total}`;
    document.getElementById("percentage").innerText = `${percent}%`;
    document.getElementById("status").innerText = finalStatus;
    document.getElementById("status").className = percent >= 50 ? "status-pass" : "status-fail";
    document.getElementById("reason").innerText = reason;

    // 4. Google Sheets par Result bhejein
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwTMB_a1P1s9ukPenPvPxVFF2ZFtyyNN0M0sPe_7FovXpNkzd7yv18LsfZeQ0Y7yN6z4A/exec";

    fetch(WEB_APP_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            name: name,
            studentClass: cls, // Apps Script ke doPost se match hona chahiye
            score: score,
            total: total
        })
    }).then(() => console.log("Data saved to Google Sheet"));

</script>

</body>
</html>
