<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exam Result | Bothverse Academy</title>
<link rel="stylesheet" href="style.css">
</head>

<body class="dark">
<div class="result-box">

    <h1>Your Scorecard</h1>
    <p id="student-meta"></p>
    <div class="score" id="display-score">0 / 0</div>
    <div id="status-msg" style="margin-bottom:20px;font-weight:bold;"></div>

    <h2>Answer Review</h2>
    <div id="review-container"></div>

    <button onclick="window.location.href='dashboard.html'">Back to Dashboard</button>
</div>

<script>
window.onload = function () {
    const name = localStorage.getItem("studentName") || "Student";
    const cls = localStorage.getItem("studentClass") || "-";
    const rawData = localStorage.getItem("reviewData");

    if (!rawData) {
        document.body.innerHTML = "<h2>No Data Found!</h2>";
        return;
    }

    const reviewData = JSON.parse(rawData);
    document.getElementById("student-meta").innerText = `${name} | Class: ${cls}`;

    let score = 0;
    const total = reviewData.length;

    const container = document.getElementById("review-container");

    reviewData.forEach((item, i) => {
        const isCorrect = item.selected === item.correct;
        if (isCorrect) score++;

        container.innerHTML += `
            <div class="review-card ${isCorrect ? 'correct' : ''}">
                <p><strong>Q${i+1}:</strong> ${item.question}</p>
                <p>Your Answer: <b>${item.options[item.selected]}</b></p>
                <p>Correct Answer: <b>${item.options[item.correct]}</b></p>
            </div>
        `;
    });

    document.getElementById("display-score").innerText = `${score} / ${total}`;
    document.getElementById("status-msg").innerHTML =
        (score / total) * 100 >= 50
        ? "<span style='color:green'>RESULT: PASS</span>"
        : "<span style='color:red'>RESULT: FAIL</span>";

    localStorage.setItem("lastExamScore", `${score} / ${total}`);

    // SEND RESULT TO GOOGLE SHEET
    fetch("https://script.google.com/macros/s/AKfycbwEo40yBXFZUUn5V-U0xWzfxZc_jb-Fludqe43CN20BAs0TlB05yxngqn0Q37ERUYWgPw/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            name: name,
            cls: cls,
            score: score,
            total: total
        })
    });
};
</script>

</body>
</html>

