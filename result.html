<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Result - Online Exam</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .result-card { text-align: left; margin-top: 20px; background: #1e293b; padding: 20px; border-radius: 10px; }
        .result-line { 
            display: flex; justify-content: space-between; 
            padding: 10px 0; border-bottom: 1px solid #334155; 
        }
        .status-pass { color: #22c55e; font-weight: bold; }
        .status-fail { color: #ef4444; font-weight: bold; }

        #review-section { margin-top: 30px; text-align: left; }
        .review-card {
            background: #0f172a; padding: 15px; border-radius: 8px;
            margin-bottom: 12px; border-left: 5px solid #ef4444;
        }
        .review-card.correct { border-left-color: #22c55e; }
        .question-text { font-weight: bold; margin-bottom: 8px; color: #f8fafc; }
        .ans-row { font-size: 14px; margin: 4px 0; }
        .correct-ans { color: #22c55e; font-weight: bold; margin-top: 5px; }
    </style>
</head>
<body class="light">

<div class="login-box" style="width: 90%; max-width: 600px; margin: 40px auto;">
    <h1>Score Card</h1>
    <h3 id="student-info" style="color: #94a3b8;"></h3>
    
    <div class="result-card">
        <div class="result-line"><span>Total Questions:</span> <span id="total-qs">0</span></div>
        <div class="result-line"><span>Score:</span> <span id="score">0</span></div>
        <div class="result-line"><span>Percentage:</span> <span id="percentage">0%</span></div>
        <div class="result-line"><span>Status:</span> <span id="status">-</span></div>
    </div>

    <div id="review-section">
        <h2 style="border-bottom: 2px solid #334155; padding-bottom: 10px;">Answer Sheet Review</h2>
        <div id="review-container"></div>
    </div>

    <button onclick="location.href='index.html'" style="margin-top: 30px; width: 100%;">Back to Home</button>
</div>

<script>
    // 1. Data load karein (exam.html mein humne 'reviewData' naam se save kiya tha)
    const name = localStorage.getItem("studentName") || "Student";
    const cls = localStorage.getItem("studentClass") || "-";
    const reviewData = JSON.parse(localStorage.getItem("reviewData")) || []; 
    const reason = localStorage.getItem("reason") || "Completed";

    document.getElementById("student-info").innerText = `${name} | Class: ${cls}`;

    // 2. Score aur Review Logic
    let score = 0;
    const total = reviewData.length;
    const reviewContainer = document.getElementById("review-container");

    if (total === 0) {
        reviewContainer.innerHTML = "<p style='color:red;'>No data found. Please complete the exam first.</p>";
    }

    reviewData.forEach((item, i) => {
        const isCorrect = item.selected === item.correct;
        if (isCorrect) score++;

        // Review UI logic
        const card = document.createElement("div");
        card.className = `review-card ${isCorrect ? 'correct' : ''}`;
        
        const selectedText = item.options[item.selected] || "Not Answered";
        const correctText = item.options[item.correct];

        card.innerHTML = `
            <div class="question-text">Q${i+1}. ${item.question}</div>
            <div class="ans-row">Your Answer: <span style="color:${isCorrect ? '#22c55e' : '#ef4444'}">${selectedText} ${isCorrect ? '‚úÖ' : '‚ùå'}</span></div>
            ${!isCorrect ? `<div class="ans-row correct-ans">Correct Answer: ${correctText}</div>` : ''}
        `;
        reviewContainer.appendChild(card);
    });

    // 3. Scorecard update
    const percent = total > 0 ? Math.round((score / total) * 100) : 0;
    document.getElementById("total-qs").innerText = total;
    document.getElementById("score").innerText = `${score} / ${total}`;
    document.getElementById("percentage").innerText = `${percent}%`;
    document.getElementById("status").innerText = percent >= 50 ? "PASS üéâ" : "FAIL ‚ùå";
    document.getElementById("status").className = percent >= 50 ? "status-pass" : "status-fail";

    // 4. Google Sheets Sync
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwTMB_a1P1s9ukPenPvPxVFF2ZFtyyNN0M0sPe_7FovXpNkzd7yv18LsfZeQ0Y7yN6z4A/exec";
    
    fetch(WEB_APP_URL, {
        method: "POST",
        mode: "no-cors",
        body: JSON.stringify({
            name: name,
            studentClass: cls,
            score: score,
            total: total
        })
    });
</script>

</body>
</html>
