<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Result</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .result-container { max-width: 600px; margin: 30px auto; padding: 20px; background: #1e293b; color: white; border-radius: 15px; text-align: center; }
        .score-box { font-size: 2.5rem; color: #22c55e; margin: 20px 0; }
        .review-card { background: #0f172a; padding: 15px; border-radius: 10px; margin-top: 15px; text-align: left; border-left: 5px solid #ef4444; }
        .review-card.correct { border-left-color: #22c55e; }
        .status-pass { color: #22c55e; font-weight: bold; }
        .status-fail { color: #ef4444; font-weight: bold; }
        .btn-home { background: #22c55e; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 20px; width: 100%; }
    </style>
</head>
<body class="light">

<div class="result-container">
    <h1>Exam Result</h1>
    <p id="student-meta" style="color: #94a3b8;"></p>
    
    <div class="score-box" id="final-score">0 / 0</div>
    <div id="status-text" style="font-size: 1.2rem; margin-bottom: 20px;"></div>

    <div id="review-section">
        <h3 style="text-align: left; border-bottom: 1px solid #334155; padding-bottom: 10px;">Review Answers</h3>
        <div id="review-container"></div>
    </div>

    <button class="btn-home" onclick="location.href='index.html'">Back to Home</button>
</div>

<script>
    // 1. Data load karein
    const name = localStorage.getItem("studentName") || "Student";
    const cls = localStorage.getItem("studentClass") || "-";
    const email = localStorage.getItem("studentEmail") || "N/A";
    const rawData = localStorage.getItem("reviewData");
    
    // Check karein agar data hi nahi hai
    if (!rawData) {
        document.body.innerHTML = "<div class='result-container'><h2>No Result Data Found!</h2><button class='btn-home' onclick='location.href=\"index.html\"'>Go Back</button></div>";
    } else {
        const reviewData = JSON.parse(rawData);
        document.getElementById("student-meta").innerText = `${name} | Class: ${cls}`;

        let score = 0;
        const total = reviewData.length;
        const container = document.getElementById("review-container");

        // 2. Review cards aur score calculation
        reviewData.forEach((item, i) => {
            const isCorrect = item.selected === item.correct;
            if (isCorrect) score++;

            const card = document.createElement("div");
            card.className = `review-card ${isCorrect ? 'correct' : ''}`;
            card.innerHTML = `
                <div style="font-weight:bold; margin-bottom:5px;">Q${i+1}. ${item.question}</div>
                <div style="font-size: 0.9rem; color: ${isCorrect ? '#22c55e' : '#ef4444'}">
                    Your Answer: ${item.options[item.selected] || "Not Answered"} ${isCorrect ? '‚úÖ' : '‚ùå'}
                </div>
                ${!isCorrect ? `<div style="font-size: 0.9rem; color: #94a3b8;">Correct Answer: ${item.options[item.correct]}</div>` : ''}
            `;
            container.appendChild(card);
        });

        // 3. Score display logic
        document.getElementById("final-score").innerText = `${score} / ${total}`;
        const percent = Math.round((score / total) * 100);
        const statusText = document.getElementById("status-text");
        
        if (percent >= 50) {
            statusText.innerHTML = `Status: <span class="status-pass">PASS (${percent}%) üéâ</span>`;
        } else {
            statusText.innerHTML = `Status: <span class="status-fail">FAIL (${percent}%) ‚ùå</span>`;
        }

        // 4. Google Sheets Sync (Optional)
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwTMB_a1P1s9ukPenPvPxVFF2ZFtyyNN0M0sPe_7FovXpNkzd7yv18LsfZeQ0Y7yN6z4A/exec";
        fetch(WEB_APP_URL, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify({ name, cls, email, score, total })
        }).catch(e => console.log("Sync Error"));
    }
</script>

</body>
</html>
