<script>
    const name = localStorage.getItem("studentName") || "Student";
    const cls = localStorage.getItem("studentClass") || "-";
    const email = localStorage.getItem("studentEmail") || "N/A";
    const reviewData = JSON.parse(localStorage.getItem("reviewData")) || []; 

    let score = 0;
    const total = reviewData.length;
    const reviewContainer = document.getElementById("review-container");

    reviewData.forEach((item, i) => {
        const isCorrect = item.selected === item.correct;
        if (isCorrect) score++;

        const card = document.createElement("div");
        card.className = `review-card ${isCorrect ? 'correct' : ''}`;
        
        card.innerHTML = `
            <div class="question-text">Q${i+1}. ${item.question}</div>
            <div class="ans-row" style="color: ${isCorrect ? '#22c55e' : '#ef4444'}">
                Your Answer: ${item.options[item.selected] || "Not Answered"} ${isCorrect ? '‚úÖ' : '‚ùå'}
            </div>
            ${!isCorrect ? `<div class="ans-row correct-ans">Correct: ${item.options[item.correct]}</div>` : ''}
        `;
        reviewContainer.appendChild(card);
    });

    const percent = total > 0 ? Math.round((score / total) * 100) : 0;
    document.getElementById("total-qs").textContent = total;
    document.getElementById("score").textContent = `${score} / ${total}`;
    document.getElementById("percentage").textContent = `${percent}%`;
    document.getElementById("status").textContent = percent >= 50 ? "PASS üéâ" : "FAIL ‚ùå";

    // Google Sheets Sync
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwTMB_a1P1s9ukPenPvPxVFF2ZFtyyNN0M0sPe_7FovXpNkzd7yv18LsfZeQ0Y7yN6z4A/exec";
    fetch(WEB_APP_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ 
            name: name, 
            studentClass: cls, 
            email: email,
            score: score, 
            total: total 
        })
    });
</script>
